{% seo %}

{% include json-ld.html %}

{%- assign social_image = page.image | default: site.logo -%}
{%- assign social_image_url = social_image -%}
{%- unless social_image contains '://' -%}
  {%- assign social_image_url = site.url | append: social_image -%}
{%- endunless -%}

{% if jekyll.environment == 'production' and site.google_analytics %}
  {% include analytics.html %}
{% endif %}

<script data-goatcounter="https://codewithshabib.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
            htmlLabels: true
        });

        // Minimal Mistakes does not apply `target` for author sidebar custom links.
        // Force external sidebar links to open in a new tab.
        document.querySelectorAll('.author__urls a[href]').forEach((link) => {
            const href = link.getAttribute('href') || '';
            if (!/^https?:\/\//i.test(href)) return;

            link.setAttribute('target', '_blank');

            const rel = (link.getAttribute('rel') || '').trim();
            const relTokens = rel ? rel.split(/\s+/) : [];
            if (!relTokens.includes('noopener')) relTokens.push('noopener');
            if (!relTokens.includes('noreferrer')) relTokens.push('noreferrer');
            link.setAttribute('rel', relTokens.join(' '));
        });

        // Force render any mermaid diagrams
        setTimeout(() => {
            document.querySelectorAll('.language-mermaid').forEach((el) => {
                // Create wrapper div with mermaid class
                const wrapper = document.createElement('div');
                wrapper.className = 'mermaid';
                wrapper.textContent = el.textContent;

                // Replace pre element with wrapper
                el.parentNode.replaceWith(wrapper);

                // Initialize mermaid on this element
                mermaid.init(undefined, wrapper);
            });
        }, 1000);
    });
</script>

<!-- Open Graph -->
<meta property="og:title" content="{{ page.title }}">
<meta property="og:description" content="{{ page.description }}">
<meta property="og:type" content="{% if page.layout == 'single' %}article{% else %}website{% endif %}">
<meta property="og:url" content="{{ site.url }}{{ page.url }}">
<meta property="og:image" content="{{ social_image_url }}">
<meta property="og:site_name" content="{{ site.title }}">
<meta name="author" content="{{ page.author }}">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ page.title }}">
<meta name="twitter:description" content="{{ page.description }}">
<meta name="twitter:image" content="{{ social_image_url }}">

<!-- Security Headers -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval';">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
